<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-node-forge/node_modules/node-forge/lib/pss.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-node-forge">npmtest-node-forge (v0.0.2)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-node-forge/node_modules/node-forge/lib/pss.js</span></h1>
    <h2>
        
        Statements: <span class="metric">5.56% <small>(5 / 90)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">6.25% <small>(2 / 32)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 3)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">5.56% <small>(5 / 90)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-node-forge/node_modules/node-forge/lib/</a> &#187; pss.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * Javascript implementation of PKCS#1 PSS signature padding.
 *
 * @author Stefan Siegl
 *
 * Copyright (c) 2012 Stefan Siegl &lt;stesie@brokenpipe.de&gt;
 */
var forge = require('./forge');
require('./random');
require('./util');
&nbsp;
// shortcut for PSS API
var pss = module.exports = forge.pss = forge.pss || {};
&nbsp;
/**
 * Creates a PSS signature scheme object.
 *
 * There are several ways to provide a salt for encoding:
 *
 * 1. Specify the saltLength only and the built-in PRNG will generate it.
 * 2. Specify the saltLength and a custom PRNG with 'getBytesSync' defined that
 *   will be used.
 * 3. Specify the salt itself as a forge.util.ByteBuffer.
 *
 * @param options the options to use:
 *          md the message digest object to use, a forge md instance.
 *          mgf the mask generation function to use, a forge mgf instance.
 *          [saltLength] the length of the salt in octets.
 *          [prng] the pseudo-random number generator to use to produce a salt.
 *          [salt] the salt to use when encoding.
 *
 * @return a signature scheme object.
 */
pss.create = <span class="fstat-no" title="function not covered" >function(options) {</span>
  // backwards compatibility w/legacy args: hash, mgf, sLen
<span class="cstat-no" title="statement not covered" >  if(arguments.length === 3) {</span>
<span class="cstat-no" title="statement not covered" >    options = {</span>
      md: arguments[0],
      mgf: arguments[1],
      saltLength: arguments[2]
    };
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  var hash = options.md;</span>
<span class="cstat-no" title="statement not covered" >  var mgf = options.mgf;</span>
<span class="cstat-no" title="statement not covered" >  var hLen = hash.digestLength;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var salt_ = options.salt || null;</span>
<span class="cstat-no" title="statement not covered" >  if(typeof salt_ === 'string') {</span>
    // assume binary-encoded string
<span class="cstat-no" title="statement not covered" >    salt_ = forge.util.createBuffer(salt_);</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  var sLen;</span>
<span class="cstat-no" title="statement not covered" >  if('saltLength' in options) {</span>
<span class="cstat-no" title="statement not covered" >    sLen = options.saltLength;</span>
  } else <span class="cstat-no" title="statement not covered" >if(salt_ !== null) {</span>
<span class="cstat-no" title="statement not covered" >    sLen = salt_.length();</span>
  } else {
<span class="cstat-no" title="statement not covered" >    throw new Error('Salt length not specified or specific salt not given.');</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  if(salt_ !== null &amp;&amp; salt_.length() !== sLen) {</span>
<span class="cstat-no" title="statement not covered" >    throw new Error('Given salt length does not match length of given salt.');</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  var prng = options.prng || forge.random;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var pssobj = {};</span>
&nbsp;
  /**
   * Encodes a PSS signature.
   *
   * This function implements EMSA-PSS-ENCODE as per RFC 3447, section 9.1.1.
   *
   * @param md the message digest object with the hash to sign.
   * @param modsBits the length of the RSA modulus in bits.
   *
   * @return the encoded message as a binary-encoded string of length
   *           ceil((modBits - 1) / 8).
   */
<span class="cstat-no" title="statement not covered" >  pssobj.encode = <span class="fstat-no" title="function not covered" >function(md, modBits) {</span></span>
<span class="cstat-no" title="statement not covered" >    var i;</span>
<span class="cstat-no" title="statement not covered" >    var emBits = modBits - 1;</span>
<span class="cstat-no" title="statement not covered" >    var emLen = Math.ceil(emBits / 8);</span>
&nbsp;
    /* 2. Let mHash = Hash(M), an octet string of length hLen. */
<span class="cstat-no" title="statement not covered" >    var mHash = md.digest().getBytes();</span>
&nbsp;
    /* 3. If emLen &lt; hLen + sLen + 2, output "encoding error" and stop. */
<span class="cstat-no" title="statement not covered" >    if(emLen &lt; hLen + sLen + 2) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error('Message is too long to encrypt.');</span>
    }
&nbsp;
    /* 4. Generate a random octet string salt of length sLen; if sLen = 0,
     *    then salt is the empty string. */
<span class="cstat-no" title="statement not covered" >    var salt;</span>
<span class="cstat-no" title="statement not covered" >    if(salt_ === null) {</span>
<span class="cstat-no" title="statement not covered" >      salt = prng.getBytesSync(sLen);</span>
    } else {
<span class="cstat-no" title="statement not covered" >      salt = salt_.bytes();</span>
    }
&nbsp;
    /* 5. Let M' = (0x)00 00 00 00 00 00 00 00 || mHash || salt; */
<span class="cstat-no" title="statement not covered" >    var m_ = new forge.util.ByteBuffer();</span>
<span class="cstat-no" title="statement not covered" >    m_.fillWithByte(0, 8);</span>
<span class="cstat-no" title="statement not covered" >    m_.putBytes(mHash);</span>
<span class="cstat-no" title="statement not covered" >    m_.putBytes(salt);</span>
&nbsp;
    /* 6. Let H = Hash(M'), an octet string of length hLen. */
<span class="cstat-no" title="statement not covered" >    hash.start();</span>
<span class="cstat-no" title="statement not covered" >    hash.update(m_.getBytes());</span>
<span class="cstat-no" title="statement not covered" >    var h = hash.digest().getBytes();</span>
&nbsp;
    /* 7. Generate an octet string PS consisting of emLen - sLen - hLen - 2
     *    zero octets.  The length of PS may be 0. */
<span class="cstat-no" title="statement not covered" >    var ps = new forge.util.ByteBuffer();</span>
<span class="cstat-no" title="statement not covered" >    ps.fillWithByte(0, emLen - sLen - hLen - 2);</span>
&nbsp;
    /* 8. Let DB = PS || 0x01 || salt; DB is an octet string of length
     *    emLen - hLen - 1. */
<span class="cstat-no" title="statement not covered" >    ps.putByte(0x01);</span>
<span class="cstat-no" title="statement not covered" >    ps.putBytes(salt);</span>
<span class="cstat-no" title="statement not covered" >    var db = ps.getBytes();</span>
&nbsp;
    /* 9. Let dbMask = MGF(H, emLen - hLen - 1). */
<span class="cstat-no" title="statement not covered" >    var maskLen = emLen - hLen - 1;</span>
<span class="cstat-no" title="statement not covered" >    var dbMask = mgf.generate(h, maskLen);</span>
&nbsp;
    /* 10. Let maskedDB = DB \xor dbMask. */
<span class="cstat-no" title="statement not covered" >    var maskedDB = '';</span>
<span class="cstat-no" title="statement not covered" >    for(i = 0; i &lt; maskLen; i++) {</span>
<span class="cstat-no" title="statement not covered" >      maskedDB += String.fromCharCode(db.charCodeAt(i) ^ dbMask.charCodeAt(i));</span>
    }
&nbsp;
    /* 11. Set the leftmost 8emLen - emBits bits of the leftmost octet in
     *     maskedDB to zero. */
<span class="cstat-no" title="statement not covered" >    var mask = (0xFF00 &gt;&gt; (8 * emLen - emBits)) &amp; 0xFF;</span>
<span class="cstat-no" title="statement not covered" >    maskedDB = String.fromCharCode(maskedDB.charCodeAt(0) &amp; ~mask) +</span>
      maskedDB.substr(1);
&nbsp;
    /* 12. Let EM = maskedDB || H || 0xbc.
     * 13. Output EM. */
<span class="cstat-no" title="statement not covered" >    return maskedDB + h + String.fromCharCode(0xbc);</span>
  };
&nbsp;
  /**
   * Verifies a PSS signature.
   *
   * This function implements EMSA-PSS-VERIFY as per RFC 3447, section 9.1.2.
   *
   * @param mHash the message digest hash, as a binary-encoded string, to
   *         compare against the signature.
   * @param em the encoded message, as a binary-encoded string
   *          (RSA decryption result).
   * @param modsBits the length of the RSA modulus in bits.
   *
   * @return true if the signature was verified, false if not.
   */
<span class="cstat-no" title="statement not covered" >  pssobj.verify = <span class="fstat-no" title="function not covered" >function(mHash, em, modBits) {</span></span>
<span class="cstat-no" title="statement not covered" >    var i;</span>
<span class="cstat-no" title="statement not covered" >    var emBits = modBits - 1;</span>
<span class="cstat-no" title="statement not covered" >    var emLen = Math.ceil(emBits / 8);</span>
&nbsp;
    /* c. Convert the message representative m to an encoded message EM
     *    of length emLen = ceil((modBits - 1) / 8) octets, where modBits
     *    is the length in bits of the RSA modulus n */
<span class="cstat-no" title="statement not covered" >    em = em.substr(-emLen);</span>
&nbsp;
    /* 3. If emLen &lt; hLen + sLen + 2, output "inconsistent" and stop. */
<span class="cstat-no" title="statement not covered" >    if(emLen &lt; hLen + sLen + 2) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error('Inconsistent parameters to PSS signature verification.');</span>
    }
&nbsp;
    /* 4. If the rightmost octet of EM does not have hexadecimal value
     *    0xbc, output "inconsistent" and stop. */
<span class="cstat-no" title="statement not covered" >    if(em.charCodeAt(emLen - 1) !== 0xbc) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error('Encoded message does not end in 0xBC.');</span>
    }
&nbsp;
    /* 5. Let maskedDB be the leftmost emLen - hLen - 1 octets of EM, and
     *    let H be the next hLen octets. */
<span class="cstat-no" title="statement not covered" >    var maskLen = emLen - hLen - 1;</span>
<span class="cstat-no" title="statement not covered" >    var maskedDB = em.substr(0, maskLen);</span>
<span class="cstat-no" title="statement not covered" >    var h = em.substr(maskLen, hLen);</span>
&nbsp;
    /* 6. If the leftmost 8emLen - emBits bits of the leftmost octet in
     *    maskedDB are not all equal to zero, output "inconsistent" and stop. */
<span class="cstat-no" title="statement not covered" >    var mask = (0xFF00 &gt;&gt; (8 * emLen - emBits)) &amp; 0xFF;</span>
<span class="cstat-no" title="statement not covered" >    if((maskedDB.charCodeAt(0) &amp; mask) !== 0) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error('Bits beyond keysize not zero as expected.');</span>
    }
&nbsp;
    /* 7. Let dbMask = MGF(H, emLen - hLen - 1). */
<span class="cstat-no" title="statement not covered" >    var dbMask = mgf.generate(h, maskLen);</span>
&nbsp;
    /* 8. Let DB = maskedDB \xor dbMask. */
<span class="cstat-no" title="statement not covered" >    var db = '';</span>
<span class="cstat-no" title="statement not covered" >    for(i = 0; i &lt; maskLen; i++) {</span>
<span class="cstat-no" title="statement not covered" >      db += String.fromCharCode(maskedDB.charCodeAt(i) ^ dbMask.charCodeAt(i));</span>
    }
&nbsp;
    /* 9. Set the leftmost 8emLen - emBits bits of the leftmost octet
     * in DB to zero. */
<span class="cstat-no" title="statement not covered" >    db = String.fromCharCode(db.charCodeAt(0) &amp; ~mask) + db.substr(1);</span>
&nbsp;
    /* 10. If the emLen - hLen - sLen - 2 leftmost octets of DB are not zero
     * or if the octet at position emLen - hLen - sLen - 1 (the leftmost
     * position is "position 1") does not have hexadecimal value 0x01,
     * output "inconsistent" and stop. */
<span class="cstat-no" title="statement not covered" >    var checkLen = emLen - hLen - sLen - 2;</span>
<span class="cstat-no" title="statement not covered" >    for(i = 0; i &lt; checkLen; i++) {</span>
<span class="cstat-no" title="statement not covered" >      if(db.charCodeAt(i) !== 0x00) {</span>
<span class="cstat-no" title="statement not covered" >        throw new Error('Leftmost octets not zero as expected');</span>
      }
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if(db.charCodeAt(checkLen) !== 0x01) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error('Inconsistent PSS signature, 0x01 marker not found');</span>
    }
&nbsp;
    /* 11. Let salt be the last sLen octets of DB. */
<span class="cstat-no" title="statement not covered" >    var salt = db.substr(-sLen);</span>
&nbsp;
    /* 12.  Let M' = (0x)00 00 00 00 00 00 00 00 || mHash || salt */
<span class="cstat-no" title="statement not covered" >    var m_ = new forge.util.ByteBuffer();</span>
<span class="cstat-no" title="statement not covered" >    m_.fillWithByte(0, 8);</span>
<span class="cstat-no" title="statement not covered" >    m_.putBytes(mHash);</span>
<span class="cstat-no" title="statement not covered" >    m_.putBytes(salt);</span>
&nbsp;
    /* 13. Let H' = Hash(M'), an octet string of length hLen. */
<span class="cstat-no" title="statement not covered" >    hash.start();</span>
<span class="cstat-no" title="statement not covered" >    hash.update(m_.getBytes());</span>
<span class="cstat-no" title="statement not covered" >    var h_ = hash.digest().getBytes();</span>
&nbsp;
    /* 14. If H = H', output "consistent." Otherwise, output "inconsistent." */
<span class="cstat-no" title="statement not covered" >    return h === h_;</span>
  };
&nbsp;
<span class="cstat-no" title="statement not covered" >  return pssobj;</span>
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Wed Apr 19 2017 07:32:48 GMT+0000 (UTC)</div>
</div>
</body>
</html>
